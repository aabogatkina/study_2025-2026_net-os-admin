---
# Preamble

## Author
author:
  name: Богаткина Алёна Александровна
  degrees: DSc
  email: 1132231437@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Презентация по лабораторной работе №7
subtitle: Администрирование сетевых подситем
license: CC BY
date: 2025-10-16

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: DejaVu Sans
romanfont: DejaVu Sans 
sansfont: DejaVu Sans 
monofont: DejaVu Sans Mono 
mainfontoptions: Ligatures=TeX 
romanfontoptions: Ligatures=TeX 
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase 
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Вводная часть

## Цель работы

Целью данной работы является получение навыков настройки межсетевого экрана в Linux в части переадресации портов и настройки Masquerading.

# Выполнение лабораторной работы

## Создание пользовательской службы firewalld

Загрузили нашу операционную систему и перешли в рабочий каталог с проектом. Запустили виртуальную машину server. Далее на виртуальной машине server вошли под созданным нами в предыдущей работе пользователем и открыли терминал. Перешли в режим суперпользователя: ```sudo -i``` ([рис. @fig-001])

![Переход в режим суперпользователя](image/1.png){#fig-001 width=70%}

## Создание пользовательской службы firewalld

Далее на основе существующего файла описания службы ssh создали файл с собственным описанием: ```cp /usr/lib/firewalld/services/ssh.xml /etc/firewalld/services/ssh-custom.xml``` ([рис. @fig-002])

![Создание файла описания службы ssh с собственным описанием](image/2.png){#fig-002 width=70%}

## Создание пользовательской службы firewalld

Далее посмотрели содержимое файла службы: ```cat /etc/firewalld/services/ssh-custom.xml```([рис. @fig-003])

![Содержимое файла службы](image/3.png){#fig-003 width=70%}

## Создание пользовательской службы firewalld

Далее открыли файл описания службы на редактирование и заменили порт 22 на новый порт (2022): ```<port protocol="tcp" port="2022"/>```. В этом же файле скорректировали описание службы, указал что это модифицированный файл службы ([рис. @fig-004]), ([рис. @fig-005])

![Открытие файла описания службы](image/4.1.png){#fig-004 width=70%}

## Создание пользовательской службы firewalld

![Редактирование файла описания службы](image/4.2.png){#fig-005 width=70%}

## Создание пользовательской службы firewalld

Посмотрели список доступных FirewallD служб: ```firewall-cmd --get-services``` ([рис. @fig-006])

![Список доступных FirewallD служб](image/5.png){#fig-006 width=70%}

## Создание пользовательской службы firewalld

Далее перезагрузили правила межсетевого экрана с сохранением информации о состоянии и вновь вывели на экран список служб, а также список активных служб ([рис. @fig-007]):

![Перезагрузка правил межсетевого экрана с сохранением информации о состоянии, список доступных служб, список активных служб](image/6.png){#fig-007 width=50%}

## Создание пользовательской службы firewalld

Добавили новую службу в FirewallD и вывели на экран список активных служб ([рис. @fig-008]):

![Добавление новой службы в FirewallD, список активных служб](image/7.png){#fig-008 width=70%}

## Создание пользовательской службы firewalld

Служба успешно добавлена в FirewallD, поэтому мы перезагрузили правила межсетевого экрана с сохранением информации о состоянии ([рис. @fig-009]):

![Перезагрузка правил межсетевого экрана с сохранением информации о состоянии](image/8.png){#fig-009 width=70%}

## Перенаправление портов

Далее организовли на сервере переадресацию с порта 2022 на порт 22: ```firewall-cmd --add-forward-port=port=2022:proto=tcp:toport=22``` ([рис. @fig-010])

![Переадресация с порта 2022 на порт 22](image/9.png){#fig-010 width=70%}

## Перенаправление портов

На клиенте попробовали получить доступ по SSH к серверу через порт 2022: ```ssh -p 2022 aabogatkina@server.aabogatkina.net``` ([рис. @fig-011])

![Доступ на клиенте по SSH к серверу через порт 2022](image/10.png){#fig-011 width=70%}

## Настройка Port Forwarding и Masquerading

На сервере посмотрели, активирована ли в ядре системы возможность перенаправления IPv4-пакетов: ```sysctl -a | grep forward``` ([рис. @fig-012])

![Проверка возможности перенаправления IPv4-пакетов в ядре системы](image/11.png){#fig-012 width=30%}

## Настройка Port Forwarding и Masquerading

Далее включили перенаправление IPv4-пакетов на сервере ([рис. @fig-013]):

![Включение перенаправления IPv4-пакетов на сервере](image/12.png){#fig-013 width=70%}

## Настройка Port Forwarding и Masquerading

Включили маскарадинг на сервере ([рис. @fig-014]):

![Включение маскарадинга на сервере](image/13.png){#fig-014 width=70%}

## Настройка Port Forwarding и Masquerading

Далее на клиенте проверили доступность выхода в Интернет ([рис. @fig-015])

![Проверка входа в Интернет на клиенте](image/14.png){#fig-015 width=50%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перешли в каталог для внесения изменений в настройки внутреннего окружения */vagrant/provision/server/*, создали в нём каталог *firewall*, в который поместили в соответствующие подкаталоги конфигурационные файлы FirewallD ([рис. @fig-016]):

![Копирование конфигурационных файлов в каталог firewall](image/15.png){#fig-016 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

В каталоге /vagrant/provision/server создали исполняемый файл firewall.sh ([рис. @fig-017]):

![Создание исполняемого файла firewall.sh](image/16.1.png){#fig-017 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Открыв его на редактирование прописали в нём следующие строки ([рис. @fig-018]):

![Редактирование файла firewall.sh](image/16.2.png){#fig-018 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Для отработки созданного скрипта во время загрузки виртуальных машин в конфигурационном файле Vagrantfile необходимо добавить в конфигурации сервера следующую запись ([рис. @fig-019]):

![Редактирование Vagrantfile](image/17.png){#fig-019 width=70%}

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы №7 мы получили навыки настройки межсетевого экрана в Linux в части переадресации портов и настройки Masquerading. 

## Список литературы

1. [Лаборатораня работа №7](https://esystem.rudn.ru/pluginfile.php/2854758/mod_resource/content/5/007-firewall.pdf)
