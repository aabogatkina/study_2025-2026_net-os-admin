---
# Preamble

## Author
author:
  name: Богаткина Алёна Александровна
  degrees: DSc
  email: 1132231437@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Презентация по лабораторной работе №11
subtitle: Администрирование сетевых подситем
license: CC BY
date: 2025-11-13

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: DejaVu Sans
romanfont: DejaVu Sans 
sansfont: DejaVu Sans 
monofont: DejaVu Sans Mono 
mainfontoptions: Ligatures=TeX 
romanfontoptions: Ligatures=TeX 
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase 
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Вводная часть

## Цель работы

Приобретение практических навыков по настройке удалённого доступа к серверу с помощью SSH.

# Выполнение лабораторной работы

## Запрет удалённого доступа по SSH для пользователя root

Загрузили нашу операционную систему и перешли в рабочий каталог с проектом. Запустили виртуальную машину server. Далее на виртуальной машине server вошли под созданным нами пользователем и открыли терминал. Перешли в режим суперпользователя: ```sudo -i``` ([рис. @fig-001])

![Переход в режим суперпользователя](image/1.png){#fig-001 width=70%}

## Запрет удалённого доступа по SSH для пользователя root

На сервере в дополнительном терминале запустили мониторинг системных событий: ```sudo -i``` и ```journalctl -x -f``` ([рис. @fig-002])

![Мониторинг системных событий (1)](image/2.png){#fig-002 width=50%}

## Запрет удалённого доступа по SSH для пользователя root

С клиента попытались получить доступ к серверу посредством SSH-соединения через пользователя root: ```ssh root@server.aabogatkina.net```([рис. @fig-003])

![Попытка получить доступ к серверу посредством SSH-соединения через пользователя root](image/3.png){#fig-003 width=70%}

## Запрет удалённого доступа по SSH для пользователя root

На сервере октрыли файл */etc/ssh/sshd_config* конфигурации sshd для редактирования и запретили вход на сервер пользователю root, установив: ```PermitRootLogin no``` ([рис. @fig-004])

![Редактирование файла /etc/ssh/sshd_config (1)](image/4.png){#fig-004 width=70%}

## Запрет удалённого доступа по SSH для пользователя root

После сохранения изменений в файле конфигурации перезапустили sshd: ```systemctl restart sshd``` ([рис. @fig-005])

![Перезапуск sshd (1)](image/5.png){#fig-005 width=70%}

## Запрет удалённого доступа по SSH для пользователя root

Повторили попытку получения доступа с клиента к серверу посредством SSH-соединения через пользователя root: ```ssh root@server``` ([рис. @fig-006])

![Повторная попытка получить доступ к серверу посредством SSH-соединения через пользователя root](image/6.png){#fig-006 width=70%}

## Ограничение списка пользователей для удалённого доступа по SSH

С клиента попытались получить доступ к серверу посредством SSH-соединения через пользователя aabogatkina: ```ssh aabogatkina@aabogatkina.user.net```. Всё проходит успешно ([рис. @fig-007])

![Попытка получить доступ к серверу посредством SSH-соединения через пользователя aabogatkina](image/7.png){#fig-007 width=70%}

## Ограничение списка пользователей для удалённого доступа по SSH

На сервере открыли файл */etc/ssh/sshd_config* конфигурации sshd на редактирование и добавили строку ```AllowUsers vagrant``` ([рис. @fig-008])

![Редактирование файла /etc/ssh/sshd_config (2)](image/8.png){#fig-008 width=30%}

## Ограничение списка пользователей для удалённого доступа по SSH

После сохранения изменений в файле конфигурации перезапустили sshd: ```systemctl restart sshd``` ([рис. @fig-009])

![Перезапуск sshd (2)](image/9.png){#fig-009 width=70%}

## Ограничение списка пользователей для удалённого доступа по SSH

Повторили попытку получения доступа с клиента к серверу посредством SSH-соединения через пользователя aabogatkina: ```ssh aabogatkina@server.aabogatkina.net``` ([рис. @fig-010])

![Повторная попытка получить доступ к серверу посредством SSH-соединения через пользователя aabogatkina](image/10.png){#fig-010 width=70%}

## Ограничение списка пользователей для удалённого доступа по SSH

В файл */etc/ssh/sshd_config* конфигурации sshd внесли следующее изменение: ```AllowUsers vagrant aabogatkina``` ([рис. @fig-011])

![Редактирование файла /etc/ssh/sshd_config (3)](image/11.png){#fig-011 width=60%}

## Ограничение списка пользователей для удалённого доступа по SSH

После сохранения изменений в файле конфигурации перезапустили sshd: ```systemctl restart sshd``` ([рис. @fig-012])

![Перезапуск sshd (3)](image/12.png){#fig-012 width=70%}

## Ограничение списка пользователей для удалённого доступа по SSH

Вновь попытались получить доступ с клиента к серверу посредством SSH-соединения через пользователя aabogatkina ([рис. @fig-013])

![Ещё одна повторная попытка получить доступ к серверу посредством SSH-соединения через пользователя aabogatkina](image/13.png){#fig-013 width=70%}

## Настройка дополнительных портов для удалённого доступа по SSH

На сервере в файле конфигурации sshd */etc/ssh/sshd_config* нашли строку Port и ниже этой строки добавили ([рис. @fig-014]):

![Редактирование файла /etc/ssh/sshd_config (4)](image/14.png){#fig-014 width=60%}

## Настройка дополнительных портов для удалённого доступа по SSH

Далее после сохранения изменений в файле конфигурации перезапустили sshd: ```systemctl restart sshd``` ([рис. @fig-015])

![Перезапуск sshd (4)](image/15.png){#fig-015 width=70%}

## Настройка дополнительных портов для удалённого доступа по SSH

Посмотрели расширенный статус работы sshd: ```systemctl status -l sshd```. Система сообщила нам об отказе в работе sshd через порт 2022 ([рис. @fig-016])

![Расширенный статус работы sshd (1)](image/16-1.png){#fig-016 width=70%}

## Настройка дополнительных портов для удалённого доступа по SSH

Посмотрели сообщения в терминале с мониторингом системных событий ([рис. @fig-017])

![Мониторинг системных событий (2)](image/16-2.png){#fig-017 width=70%}

## Настройка дополнительных портов для удалённого доступа по SSH

Далее исправили на сервере метки SELinux к порту 2022: ```semanage port -a -t ssh_port_t -p tcp 2022``` ([рис. @fig-018])

![Исправление меток SELinux к порту 2022](image/17.png){#fig-018 width=70%}

## Настройка дополнительных портов для удалённого доступа по SSH

В настройках межсетевого экрана открыли порт 2022 протокола TCP ([рис. @fig-019]):

![Настройка межсетевго экрана](image/18.png){#fig-019 width=70%}

## Настройка дополнительных портов для удалённого доступа по SSH

Вновь перезапустили sshd и посмотрели расширенный статус его работы. Статус показывает, что процесс sshd теперь прослушивает два порта ([рис. @fig-020])

![Расширенный статус работы sshd (2)](image/19.png){#fig-020 width=60%}

## Настройка дополнительных портов для удалённого доступа по SSH

С клиента попытались получить доступ к серверу посредством SSH-соединения через пользователя aabogatkina: ```ssh aabogatkina@server.aabogatkina.net```. После открытия оболочки пользователя ввели ```sudo -i``` для получения доступа root. Отлогинились от root и нашего пользователя на сервере, введя дважды ```logout``` ([рис. @fig-021])

![Успешное подключение к серверу](image/20.png){#fig-021 width=60%}

## Настройка дополнительных портов для удалённого доступа по SSH

Повторили попытку получения доступа с клиента к серверу посредством SSH-соединения через пользователя aabogatkina, указав порт 2022: ```ssh -p 2022 aabogatkina@server.aabogatkina.net```. После открытия оболочки пользователя ввели ```sudo -i``` для получения доступа root. Отлогинились от root и нашего пользователя на сервере, введя дважды ```logout``` ([рис. @fig-022])

![Успешное подключение к серверу по порту 2022](image/21.png){#fig-022 width=50%}

## Настройка удалённого доступа по SSH по ключу

На сервере в конфигурационном файле */etc/ssh/sshd_config* задали параметр, разрешающий аутентификацию по ключу: ```PubkeyAuthentication yes``` ([рис. @fig-023])

![Редактирование файла /etc/ssh/sshd_config (5)](image/22.png){#fig-023 width=70%}

## Настройка удалённого доступа по SSH по ключу
 
После сохранения изменений в файле конфигурации перезапустили sshd ([рис. @fig-024])

![Перезапуск sshd (5)](image/23.png){#fig-024 width=70%}

## Настройка удалённого доступа по SSH по ключу

На клиенте сформировали SSH-ключ, введя в терминале под пользователем aabogatkina: ```ssh-keygen -t rsa -b 4096 ```. Закрытый ключ теперь будет записан в файл *~/.ssh/id_rsa*, а открытый ключ записывается в файл *~/.ssh/id_rsa.pub* ([рис. @fig-025])

![Формировнаие SSH-ключа](image/24.png){#fig-025 width=50%}

## Настройка удалённого доступа по SSH по ключу

Скопировали открытый ключ на сервер, введя на клиенте: ```ssh-copy-id aabogatkina@server.aabogatkina.net```. При запросе ввели пароль пользователя на удалённом сервере ([рис. @fig-026])

![Копирование открытого ключа на серевр](image/25.png){#fig-026 width=70%}

## Настройка удалённого доступа по SSH по ключу

Попробовали получить доступ с клиента к серверу посредством SSH-соединения: ```ssh aabogatkina@server.aabogatkina.net```. Теперь мы проходим аутентификацию без ввода пароля для учётной записи удалённого пользователя. Отлогинились с сервера, используя комбинацию клавиш *Ctrl + d* ([рис. @fig-027])

![Аутентификация без ввода пароля](image/26.png){#fig-027 width=70%}

## Организация туннелей SSH, перенаправление TCP-портов

На клиенте посмотрели, запущены ли какие-то службы с протоколом TCP: ```lsof | grep TCP``` ([рис. @fig-028])

![Просмотр запущенных служб с протоколом TCP](image/27.png){#fig-028 width=70%}

## Организация туннелей SSH, перенаправление TCP-портов

Далее перенаправили порт 80 на server.aabogatkina.net на порт 8080 на локальной машине: ```ssh -fNL 8080:localhost:80 aabogatkina@server.aabogatkina.net``` ([рис. @fig-029])

![Перенаправление TCP порта](image/28.png){#fig-029 width=70%}

## Организация туннелей SSH, перенаправление TCP-портов

Вновь на клиенте посмотрели, запущены ли какие-то службы с протоколом TCP: ```lsof | grep TCP``` ([рис. @fig-030])

![Повторный просмотр запущенных служб с протоколом TCP](image/29.png){#fig-030 width=70%}

## Организация туннелей SSH, перенаправление TCP-портов

На клиенте запустили браузер и в адресной строке ввели localhost:8080. Убедились, что отобразилась страница с приветствием «Welcome to the server.aabogatkina.net server» ([рис. @fig-031])

![Запуск браузера на клиенте и ввод в адресной строке localhost:8080](image/30.png){#fig-031 width=70%}

## Запуск консольных приложений через SSH

На клиенте открыли терминал под пользователем aabogatkina и посмотрели с клиента имя узла сервера: ```ssh aabogatkina@server.aabogatkina.net hostname``` ([рис. @fig-032])

![Просмотр имени узла сервера с клиента](image/31.png){#fig-032 width=70%}

## Запуск консольных приложений через SSH

Посмотрели с клиента список файлов на сервере: ```ssh aabogatkina@server.aabogatkina.net ls -Al``` ([рис. @fig-033])

![Просмотр списка файлов на сервере с клиента](image/32.png){#fig-033 width=60%}

## Запуск консольных приложений через SSH

Посмотрели с клиента почту на сервере: ```ssh aabogatkina@server.aabogatkina.net MAIL=~/Maildir/ mail``` ([рис. @fig-034])

![Просмотр почты на сервере с клиента](image/33.png){#fig-034 width=70%}

## Запуск графических приложений через SSH (X11Forwarding)

На сервере в конфигурационном файле */etc/ssh/sshd_config* разрешили отображать на локальном клиентском компьютере графические интерфейсы X11: ```X11Forwarding yes``` ([рис. @fig-035])

![Редактирование файла /etc/ssh/sshd_config (6)](image/34.png){#fig-035 width=50%}

## Запуск графических приложений через SSH (X11Forwarding)

После сохранения изменения в конфигурационном файле перезапустили sshd ([рис. @fig-036])

![Перезапуск sshd (6)](image/35.png){#fig-036 width=70%}

## Запуск графических приложений через SSH (X11Forwarding)

Далее попробовали с клиента удалённо подключиться к серверу и запустить графическое
приложение, например firefox: ```ssh -YC aabogatkina@server.aabogatkina.net firefox``` ([рис. @fig-037])

![Подключение к серверу с клиента и запуск графического приложения firefox](image/36.png){#fig-037 width=35%} 

## Внесение изменений в настройки внутреннего окружения виртуальной машины

На виртуальной машине server перешли в каталог для внесения изменений в настройки внутреннего окружения */vagrant/provision/server/*, создали в нём каталог ssh, в который поместили в соответствующие подкаталоги поместили конфигурационный файл sshd_config ([рис. @fig-038]):

![Копирование конфигурационного файла sshd_config](image/37.png){#fig-038 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

В каталоге /vagrant/provision/server создали исполняемый файл ssh.sh ([рис. @fig-039]):

![Создание исполняемого файла ssh.sh](image/38.png){#fig-039 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Открыв его на редактирование, прописали в нём следующий скрипт ([рис. @fig-040]):

![Редактирование файла ssh.sh](image/39.png){#fig-040 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Для отработки созданного скрипта во время загрузки виртуальной машины server в конфигурационный файл Vagrantfile добавили в разделе конфигурации для сервера ([рис. @fig-041]):

![Редактирование файла Vagrantfile](image/40.png){#fig-041 width=70%}

# Подведение итогов

## Выводы

В ходе выполнения лабораторной работы №11 мы приобрели практические навыки по настройке удалённого доступа к серверу с помощью SSH.

## Список литературы

1. [Лаборатораня работа №11](https://esystem.rudn.ru/pluginfile.php/2854774/mod_resource/content/6/011-ssh.pdf)
